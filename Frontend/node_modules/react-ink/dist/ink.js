module.exports=function(t){function e(n){if(o[n])return o[n].exports;var i=o[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e,o){"use strict";var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},i=o(4),r=0,a=o(5),s=o(8),u=o(2),c=o(7),l=s.PropTypes,h=2*Math.PI,p=o(1),f=o(6),d=s.createClass({displayName:"Ink",shouldComponentUpdate:f,propTypes:{background:l.bool,duration:l.number,opacity:l.number,radius:l.number,recenter:l.bool,hasTouch:l.bool},getDefaultProps:function(){return{background:!0,duration:1e3,opacity:.25,radius:150,recenter:!0,hasTouch:i}},getInitialState:function(){return{color:"transparent",density:1,height:0,store:c(this.tick),touchEvents:this.touchEvents(),width:0}},touchEvents:function(){return this.props.hasTouch?{onTouchStart:this._onPress,onTouchEnd:this._onRelease,onTouchCancel:this._onRelease,onTouchLeave:this._onRelease}:{onMouseDown:this._onPress,onMouseUp:this._onRelease,onMouseLeave:this._onRelease}},tick:function(){var t=this.state,e=t.ctx,o=t.color,n=t.density,i=t.height,r=t.width,a=t.store;e.save(),e.scale(n,n),e.clearRect(0,0,r,i),e.fillStyle=o,this.props.background&&(e.globalAlpha=a.getTotalOpacity(this.props.opacity),e.fillRect(0,0,r,i)),a.each(this.makeBlot,this),e.restore()},makeBlot:function(t){var e=this.state,o=e.ctx,n=e.height,i=e.width,r=t.x,a=t.y,s=t.radius;if(o.globalAlpha=p.getBlotOpacity(t,this.props.opacity),o.beginPath(),this.props.recenter){var u=Math.max(n,i);r+=p.getBlotShiftX(t,u,i),a+=p.getBlotShiftY(t,u,n)}o.arc(r,a,s*p.getBlotScale(t),0,h),o.closePath(),o.fill()},componentWillUnmount:function(){this.state.store.stop()},pushBlot:function(t,e,o){var n=this,i=this.refs.canvas;i instanceof window.HTMLCanvasElement==!1&&(i=i.getDOMNode());var r=i.getBoundingClientRect(),s=r.top,u=r.bottom,c=r.left,l=r.right,h=window.getComputedStyle(i),f=h.color,d=this.state.ctx||i.getContext("2d"),g=a(d),v=u-s,m=l-c,x=p.getMaxRadius(v,m,this.props.radius);this.setState({color:f,ctx:d,density:g,height:v,width:m},function(){n.state.store.add({duration:n.props.duration,mouseDown:t,mouseUp:0,radius:x,x:e-c,y:o-s})})},render:function(){var t=this.state,e=t.density,o=t.height,i=t.width,r=t.touchEvents;return s.createElement("canvas",n({className:"ink",ref:"canvas",style:n({},u,this.props.style),height:o*e,width:i*e,onDragOver:this._onRelease},r))},_onPress:function(t){var e=t.button,o=t.ctrlKey,n=t.clientX,i=t.clientY,a=t.changedTouches,s=Date.now();if(a)for(var u=0;u<a.length;u++){var c=a[u],l=c.clientX,h=c.clientY;this.pushBlot(s,l,h)}else e!==r||o||this.pushBlot(s,n,i)},_onRelease:function(){this.state.store.release(Date.now())}});t.exports=d},function(t,e,o){"use strict";function n(t){return l(t.duration,Date.now()-t.mouseDown)}function i(t){return t.mouseUp>0?Date.now()-t.mouseUp:0}function r(t){var e=t.duration,o=t.radius,r=.85*a(n(t),0,o,e),s=.15*a(i(t),0,o,e),l=.02*o*u(Date.now()/e);return c(0,r+s+l)}var a=o(3),s=Math.sqrt(2),u=Math.cos,c=Math.max,l=Math.min;t.exports={getMaxRadius:function(t,e,o){return l(.5*c(t,e),o)},getBlotOpacity:function(t,e){return a(i(t),e,-e,t.duration)},getBlotOuterOpacity:function(t,e){return l(this.getBlotOpacity(t,e),a(n(t),0,.3,3*t.duration))},getBlotShiftX:function(t,e,o){return l(1,r(t)/e*2/s)*(o/2-t.x)},getBlotShiftY:function(t,e,o){return l(1,r(t)/e*2/s)*(o/2-t.y)},getBlotScale:function(t){return r(t)/t.radius}}},function(t,e){"use strict";t.exports={borderRadius:"inherit",height:"100%",left:0,position:"absolute",top:0,width:"100%"}},function(t,e){"use strict";t.exports=function(t,e,o,n){return o*((t=t/n-1)*t*t*t*t+1)+e}},function(t,e){"use strict";var o=!1;"undefined"!=typeof window&&(o="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),t.exports=o},function(t,e){"use strict";e.__esModule=!0,e["default"]=function(t){var e=window.devicePixelRatio||1,o=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e/o},t.exports=e["default"]},function(t,e){"use strict";function o(t,e){for(var o in t)if(this.props[o]!==t[o])return!0;for(var n in e)if(this.state[n]!==e[n])return!0;return!1}e.__esModule=!0,e["default"]=o,t.exports=e["default"]},function(t,e,o){"use strict";var n=o(1),i=function(t){var e=t.mouseUp,o=t.duration;return!e||Date.now()-e<o};t.exports=function(t){var e=[],o=!1,r=void 0,a={each:function(t,o){for(var n=0,i=e.length;i>n;n++)t.call(o,e[n])},play:function(){o||(o=!0,a.update())},stop:function(){o=!1,cancelAnimationFrame(r)},getTotalOpacity:function(t){for(var o=0,i=0,r=e.length;r>i;i++)o+=n.getBlotOuterOpacity(e[i],t);return o},update:function(){e=e.filter(i),e.length?(r=requestAnimationFrame(a.update),t()):a.stop()},add:function(t){e.push(t),a.play()},release:function(t){for(var o=e.length-1;o>=0;o--)if(!e[o].mouseUp)return e[o].mouseUp=t}};return a}},function(t,e){t.exports=require("react")}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vaW5rLmpzIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCBjMjhmMWNkM2E2NzYwNTczMDg2OCIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanN4Iiwid2VicGFjazovLy8uL3NyYy91dGlsL2VxdWF0aW9ucy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvc3R5bGUuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWwvZWFzaW5nLmpzIiwid2VicGFjazovLy8uL3NyYy91dGlsL2hhc1RvdWNoLmpzIiwid2VicGFjazovLy8uL3NyYy91dGlsL3BpeGVsUmF0aW8uanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWwvcHVyZS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbC9zdG9yZS5qcyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJyZWFjdFwiIl0sIm5hbWVzIjpbIm1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImlkIiwibG9hZGVkIiwiY2FsbCIsIm0iLCJjIiwicCIsIl9leHRlbmRzIiwiT2JqZWN0IiwiYXNzaWduIiwidGFyZ2V0IiwiaSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInNvdXJjZSIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiSEFTX1RPVUNIIiwiTU9VU0VfTEVGVCIsInBpeGVsUmF0aW8iLCJSZWFjdCIsIlNUWUxFIiwiU3RvcmUiLCJUeXBlcyIsIlByb3BUeXBlcyIsIlRBVSIsIk1hdGgiLCJQSSIsIkVxdWF0aW9ucyIsIlB1cmUiLCJJbmsiLCJjcmVhdGVDbGFzcyIsImRpc3BsYXlOYW1lIiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwicHJvcFR5cGVzIiwiYmFja2dyb3VuZCIsImJvb2wiLCJkdXJhdGlvbiIsIm51bWJlciIsIm9wYWNpdHkiLCJyYWRpdXMiLCJyZWNlbnRlciIsImhhc1RvdWNoIiwiZ2V0RGVmYXVsdFByb3BzIiwiZ2V0SW5pdGlhbFN0YXRlIiwiY29sb3IiLCJkZW5zaXR5IiwiaGVpZ2h0Iiwic3RvcmUiLCJ0aGlzIiwidGljayIsInRvdWNoRXZlbnRzIiwid2lkdGgiLCJwcm9wcyIsIm9uVG91Y2hTdGFydCIsIl9vblByZXNzIiwib25Ub3VjaEVuZCIsIl9vblJlbGVhc2UiLCJvblRvdWNoQ2FuY2VsIiwib25Ub3VjaExlYXZlIiwib25Nb3VzZURvd24iLCJvbk1vdXNlVXAiLCJvbk1vdXNlTGVhdmUiLCJfc3RhdGUiLCJzdGF0ZSIsImN0eCIsInNhdmUiLCJzY2FsZSIsImNsZWFyUmVjdCIsImZpbGxTdHlsZSIsImdsb2JhbEFscGhhIiwiZ2V0VG90YWxPcGFjaXR5IiwiZmlsbFJlY3QiLCJlYWNoIiwibWFrZUJsb3QiLCJyZXN0b3JlIiwiYmxvdCIsIl9zdGF0ZTIiLCJ4IiwieSIsImdldEJsb3RPcGFjaXR5IiwiYmVnaW5QYXRoIiwic2l6ZSIsIm1heCIsImdldEJsb3RTaGlmdFgiLCJnZXRCbG90U2hpZnRZIiwiYXJjIiwiZ2V0QmxvdFNjYWxlIiwiY2xvc2VQYXRoIiwiZmlsbCIsImNvbXBvbmVudFdpbGxVbm1vdW50Iiwic3RvcCIsInB1c2hCbG90IiwidGltZVN0YW1wIiwiY2xpZW50WCIsImNsaWVudFkiLCJfdGhpcyIsImVsIiwicmVmcyIsImNhbnZhcyIsIndpbmRvdyIsIkhUTUxDYW52YXNFbGVtZW50IiwiZ2V0RE9NTm9kZSIsIl9lbCRnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiLCJfd2luZG93JGdldENvbXB1dGVkU3R5bGUiLCJnZXRDb21wdXRlZFN0eWxlIiwiZ2V0Q29udGV4dCIsImdldE1heFJhZGl1cyIsInNldFN0YXRlIiwiYWRkIiwibW91c2VEb3duIiwibW91c2VVcCIsInJlbmRlciIsIl9zdGF0ZTMiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwicmVmIiwic3R5bGUiLCJvbkRyYWdPdmVyIiwiZSIsImJ1dHRvbiIsImN0cmxLZXkiLCJjaGFuZ2VkVG91Y2hlcyIsIkRhdGUiLCJub3ciLCJfY2hhbmdlZFRvdWNoZXMkaSIsIl9jbGllbnRYIiwiX2NsaWVudFkiLCJyZWxlYXNlIiwiZ2V0UHJlc3MiLCJtaW4iLCJnZXRSZWxlYXNlIiwiZ2V0UmFkaXVzIiwiZG93biIsImVhc2luZyIsInVwIiwidW5kdWxhdGlvbiIsImNvcyIsIlNRUlRfMiIsInNxcnQiLCJnZXRCbG90T3V0ZXJPcGFjaXR5IiwiYm9yZGVyUmFkaXVzIiwicG9zaXRpb24iLCJ0IiwiYiIsImQiLCJEb2N1bWVudFRvdWNoIiwiZG9jdW1lbnQiLCJfX2VzTW9kdWxlIiwiY29udGV4dCIsImRldmljZVBpeGVsUmF0aW8iLCJiYWNraW5nU3RvcmVSYXRpbyIsIndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW8iLCJtb3pCYWNraW5nU3RvcmVQaXhlbFJhdGlvIiwibXNCYWNraW5nU3RvcmVQaXhlbFJhdGlvIiwib0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8iLCJiYWNraW5nU3RvcmVQaXhlbFJhdGlvIiwicyIsImtpbGxTdGFsZSIsIl9yZWYiLCJwdWJsaWNpemUiLCJfZGF0YSIsIl9wbGF5aW5nIiwiX2ZyYW1lIiwidW5kZWZpbmVkIiwiY2FsbGJhY2siLCJzY29wZSIsImwiLCJwbGF5IiwidXBkYXRlIiwiY2FuY2VsQW5pbWF0aW9uRnJhbWUiLCJhbnN3ZXIiLCJmaWx0ZXIiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJwdXNoIiwidGltZSIsInJlcXVpcmUiXSwibWFwcGluZ3MiOiJBQUFBQSxPQUFPQyxRQUNFLFNBQVVDLEdDR25CLFFBQUFDLEdBQUFDLEdBR0EsR0FBQUMsRUFBQUQsR0FDQSxNQUFBQyxHQUFBRCxHQUFBSCxPQUdBLElBQUFELEdBQUFLLEVBQUFELElBQ0FILFdBQ0FLLEdBQUFGLEVBQ0FHLFFBQUEsRUFVQSxPQU5BTCxHQUFBRSxHQUFBSSxLQUFBUixFQUFBQyxRQUFBRCxJ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b3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9XG4vKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4vKioqKioqLyBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4vKioqKioqLyBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fSxcbi8qKioqKiovIFx0XHRcdGlkOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGxvYWRlZDogZmFsc2Vcbi8qKioqKiovIFx0XHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbi8qKioqKiovIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuLyoqKioqKi8gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuLyoqKioqKi9cbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qKlxuXHQgKiBJbmtcblx0ICogRmlsbHMgYSBjb250YWluZXIgd2l0aCBhbiBTVkcgb2JqZWN0IHRoYXQgcHJvdmlkZXMgZmVlZGJhY2sgb24gbW91c2UvdG91Y2hcblx0ICogZXZlbnRzIHdpdGggYSByaXBwbGluZyBwb29sLlxuXHQgKi9cblx0XG5cdCd1c2Ugc3RyaWN0Jztcblx0XG5cdHZhciBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOyBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSB9IHJldHVybiB0YXJnZXQ7IH07XG5cdFxuXHR2YXIgSEFTX1RPVUNIID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTtcblx0dmFyIE1PVVNFX0xFRlQgPSAwO1xuXHR2YXIgcGl4ZWxSYXRpbyA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7XG5cdHZhciBSZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7XG5cdHZhciBTVFlMRSA9IF9fd2VicGFja19yZXF1aXJlX18oMik7XG5cdHZhciBTdG9yZSA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7XG5cdHZhciBUeXBlcyA9IFJlYWN0LlByb3BUeXBlcztcblx0dmFyIFRBVSA9IE1hdGguUEkgKiAyO1xuXHR2YXIgRXF1YXRpb25zID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblx0dmFyIFB1cmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpO1xuXHRcblx0dmFyIEluayA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblx0ICBkaXNwbGF5TmFtZTogJ0luaycsXG5cdFxuXHQgIHNob3VsZENvbXBvbmVudFVwZGF0ZTogUHVyZSxcblx0XG5cdCAgcHJvcFR5cGVzOiB7XG5cdCAgICBiYWNrZ3JvdW5kOiBUeXBlcy5ib29sLFxuXHQgICAgZHVyYXRpb246IFR5cGVzLm51bWJlcixcblx0ICAgIG9wYWNpdHk6IFR5cGVzLm51bWJlcixcblx0ICAgIHJhZGl1czogVHlwZXMubnVtYmVyLFxuXHQgICAgcmVjZW50ZXI6IFR5cGVzLmJvb2wsXG5cdCAgICBoYXNUb3VjaDogVHlwZXMuYm9vbFxuXHQgIH0sXG5cdFxuXHQgIGdldERlZmF1bHRQcm9wczogZnVuY3Rpb24gZ2V0RGVmYXVsdFByb3BzKCkge1xuXHQgICAgcmV0dXJuIHtcblx0ICAgICAgYmFja2dyb3VuZDogdHJ1ZSxcblx0ICAgICAgZHVyYXRpb246IDEwMDAsXG5cdCAgICAgIG9wYWNpdHk6IDAuMjUsXG5cdCAgICAgIHJhZGl1czogMTUwLFxuXHQgICAgICByZWNlbnRlcjogdHJ1ZSxcblx0ICAgICAgaGFzVG91Y2g6IEhBU19UT1VDSFxuXHQgICAgfTtcblx0ICB9LFxuXHRcblx0ICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcblx0ICAgIHJldHVybiB7XG5cdCAgICAgIGNvbG9yOiAndHJhbnNwYXJlbnQnLFxuXHQgICAgICBkZW5zaXR5OiAxLFxuXHQgICAgICBoZWlnaHQ6IDAsXG5cdCAgICAgIHN0b3JlOiBTdG9yZSh0aGlzLnRpY2spLFxuXHQgICAgICB0b3VjaEV2ZW50czogdGhpcy50b3VjaEV2ZW50cygpLFxuXHQgICAgICB3aWR0aDogMFxuXHQgICAgfTtcblx0ICB9LFxuXHRcblx0ICB0b3VjaEV2ZW50czogZnVuY3Rpb24gdG91Y2hFdmVudHMoKSB7XG5cdCAgICBpZiAodGhpcy5wcm9wcy5oYXNUb3VjaCkge1xuXHQgICAgICByZXR1cm4ge1xuXHQgICAgICAgIG9uVG91Y2hTdGFydDogdGhpcy5fb25QcmVzcyxcblx0ICAgICAgICBvblRvdWNoRW5kOiB0aGlzLl9vblJlbGVhc2UsXG5cdCAgICAgICAgb25Ub3VjaENhbmNlbDogdGhpcy5fb25SZWxlYXNlLFxuXHQgICAgICAgIG9uVG91Y2hMZWF2ZTogdGhpcy5fb25SZWxlYXNlXG5cdCAgICAgIH07XG5cdCAgICB9IGVsc2Uge1xuXHQgICAgICByZXR1cm4ge1xuXHQgICAgICAgIG9uTW91c2VEb3duOiB0aGlzLl9vblByZXNzLFxuXHQgICAgICAgIG9uTW91c2VVcDogdGhpcy5fb25SZWxlYXNlLFxuXHQgICAgICAgIG9uTW91c2VMZWF2ZTogdGhpcy5fb25SZWxlYXNlXG5cdCAgICAgIH07XG5cdCAgICB9XG5cdCAgfSxcblx0XG5cdCAgdGljazogZnVuY3Rpb24gdGljaygpIHtcblx0ICAgIHZhciBfc3RhdGUgPSB0aGlzLnN0YXRlO1xuXHQgICAgdmFyIGN0eCA9IF9zdGF0ZS5jdHg7XG5cdCAgICB2YXIgY29sb3IgPSBfc3RhdGUuY29sb3I7XG5cdCAgICB2YXIgZGVuc2l0eSA9IF9zdGF0ZS5kZW5zaXR5O1xuXHQgICAgdmFyIGhlaWdodCA9IF9zdGF0ZS5oZWlnaHQ7XG5cdCAgICB2YXIgd2lkdGggPSBfc3RhdGUud2lkdGg7XG5cdCAgICB2YXIgc3RvcmUgPSBfc3RhdGUuc3RvcmU7XG5cdFxuXHQgICAgY3R4LnNhdmUoKTtcblx0XG5cdCAgICBjdHguc2NhbGUoZGVuc2l0eSwgZGVuc2l0eSk7XG5cdFxuXHQgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcblx0XG5cdCAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7XG5cdFxuXHQgICAgaWYgKHRoaXMucHJvcHMuYmFja2dyb3VuZCkge1xuXHQgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBzdG9yZS5nZXRUb3RhbE9wYWNpdHkodGhpcy5wcm9wcy5vcGFjaXR5KTtcblx0ICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuXHQgICAgfVxuXHRcblx0ICAgIHN0b3JlLmVhY2godGhpcy5tYWtlQmxvdCwgdGhpcyk7XG5cdFxuXHQgICAgY3R4LnJlc3RvcmUoKTtcblx0ICB9LFxuXHRcblx0ICBtYWtlQmxvdDogZnVuY3Rpb24gbWFrZUJsb3QoYmxvdCkge1xuXHQgICAgdmFyIF9zdGF0ZTIgPSB0aGlzLnN0YXRlO1xuXHQgICAgdmFyIGN0eCA9IF9zdGF0ZTIuY3R4O1xuXHQgICAgdmFyIGhlaWdodCA9IF9zdGF0ZTIuaGVpZ2h0O1xuXHQgICAgdmFyIHdpZHRoID0gX3N0YXRlMi53aWR0aDtcblx0ICAgIHZhciB4ID0gYmxvdC54O1xuXHQgICAgdmFyIHkgPSBibG90Lnk7XG5cdCAgICB2YXIgcmFkaXVzID0gYmxvdC5yYWRpdXM7XG5cdFxuXHQgICAgY3R4Lmdsb2JhbEFscGhhID0gRXF1YXRpb25zLmdldEJsb3RPcGFjaXR5KGJsb3QsIHRoaXMucHJvcHMub3BhY2l0eSk7XG5cdCAgICBjdHguYmVnaW5QYXRoKCk7XG5cdFxuXHQgICAgaWYgKHRoaXMucHJvcHMucmVjZW50ZXIpIHtcblx0ICAgICAgdmFyIHNpemUgPSBNYXRoLm1heChoZWlnaHQsIHdpZHRoKTtcblx0XG5cdCAgICAgIHggKz0gRXF1YXRpb25zLmdldEJsb3RTaGlmdFgoYmxvdCwgc2l6ZSwgd2lkdGgpO1xuXHQgICAgICB5ICs9IEVxdWF0aW9ucy5nZXRCbG90U2hpZnRZKGJsb3QsIHNpemUsIGhlaWdodCk7XG5cdCAgICB9XG5cdFxuXHQgICAgY3R4LmFyYyh4LCB5LCByYWRpdXMgKiBFcXVhdGlvbnMuZ2V0QmxvdFNjYWxlKGJsb3QpLCAwLCBUQVUpO1xuXHRcblx0ICAgIGN0eC5jbG9zZVBhdGgoKTtcblx0ICAgIGN0eC5maWxsKCk7XG5cdCAgfSxcblx0XG5cdCAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuXHQgICAgdGhpcy5zdGF0ZS5zdG9yZS5zdG9wKCk7XG5cdCAgfSxcblx0XG5cdCAgcHVzaEJsb3Q6IGZ1bmN0aW9uIHB1c2hCbG90KHRpbWVTdGFtcCwgY2xpZW50WCwgY2xpZW50WSkge1xuXHQgICAgdmFyIF90aGlzID0gdGhpcztcblx0XG5cdCAgICB2YXIgZWwgPSB0aGlzLnJlZnMuY2FudmFzO1xuXHRcblx0ICAgIC8vIDAuMTMgc3VwcG9ydFxuXHQgICAgaWYgKGVsIGluc3RhbmNlb2Ygd2luZG93LkhUTUxDYW52YXNFbGVtZW50ID09PSBmYWxzZSkge1xuXHQgICAgICBlbCA9IGVsLmdldERPTU5vZGUoKTtcblx0ICAgIH1cblx0XG5cdCAgICB2YXIgX2VsJGdldEJvdW5kaW5nQ2xpZW50UmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXHRcblx0ICAgIHZhciB0b3AgPSBfZWwkZ2V0Qm91bmRpbmdDbGllbnRSZWN0LnRvcDtcblx0ICAgIHZhciBib3R0b20gPSBfZWwkZ2V0Qm91bmRpbmdDbGllbnRSZWN0LmJvdHRvbTtcblx0ICAgIHZhciBsZWZ0ID0gX2VsJGdldEJvdW5kaW5nQ2xpZW50UmVjdC5sZWZ0O1xuXHQgICAgdmFyIHJpZ2h0ID0gX2VsJGdldEJvdW5kaW5nQ2xpZW50UmVjdC5yaWdodDtcblx0XG5cdCAgICB2YXIgX3dpbmRvdyRnZXRDb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpO1xuXHRcblx0ICAgIHZhciBjb2xvciA9IF93aW5kb3ckZ2V0Q29tcHV0ZWRTdHlsZS5jb2xvcjtcblx0XG5cdCAgICB2YXIgY3R4ID0gdGhpcy5zdGF0ZS5jdHggfHwgZWwuZ2V0Q29udGV4dCgnMmQnKTtcblx0ICAgIHZhciBkZW5zaXR5ID0gcGl4ZWxSYXRpbyhjdHgpO1xuXHQgICAgdmFyIGhlaWdodCA9IGJvdHRvbSAtIHRvcDtcblx0ICAgIHZhciB3aWR0aCA9IHJpZ2h0IC0gbGVmdDtcblx0ICAgIHZhciByYWRpdXMgPSBFcXVhdGlvbnMuZ2V0TWF4UmFkaXVzKGhlaWdodCwgd2lkdGgsIHRoaXMucHJvcHMucmFkaXVzKTtcblx0XG5cdCAgICB0aGlzLnNldFN0YXRlKHsgY29sb3I6IGNvbG9yLCBjdHg6IGN0eCwgZGVuc2l0eTogZGVuc2l0eSwgaGVpZ2h0OiBoZWlnaHQsIHdpZHRoOiB3aWR0aCB9LCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgIF90aGlzLnN0YXRlLnN0b3JlLmFkZCh7XG5cdCAgICAgICAgZHVyYXRpb246IF90aGlzLnByb3BzLmR1cmF0aW9uLFxuXHQgICAgICAgIG1vdXNlRG93bjogdGltZVN0YW1wLFxuXHQgICAgICAgIG1vdXNlVXA6IDAsXG5cdCAgICAgICAgcmFkaXVzOiByYWRpdXMsXG5cdCAgICAgICAgeDogY2xpZW50WCAtIGxlZnQsXG5cdCAgICAgICAgeTogY2xpZW50WSAtIHRvcFxuXHQgICAgICB9KTtcblx0ICAgIH0pO1xuXHQgIH0sXG5cdFxuXHQgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuXHQgICAgdmFyIF9zdGF0ZTMgPSB0aGlzLnN0YXRlO1xuXHQgICAgdmFyIGRlbnNpdHkgPSBfc3RhdGUzLmRlbnNpdHk7XG5cdCAgICB2YXIgaGVpZ2h0ID0gX3N0YXRlMy5oZWlnaHQ7XG5cdCAgICB2YXIgd2lkdGggPSBfc3RhdGUzLndpZHRoO1xuXHQgICAgdmFyIHRvdWNoRXZlbnRzID0gX3N0YXRlMy50b3VjaEV2ZW50cztcblx0XG5cdCAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudCgnY2FudmFzJywgX2V4dGVuZHMoeyBjbGFzc05hbWU6ICdpbmsnLFxuXHQgICAgICByZWY6ICdjYW52YXMnLFxuXHQgICAgICBzdHlsZTogX2V4dGVuZHMoe30sIFNUWUxFLCB0aGlzLnByb3BzLnN0eWxlKSxcblx0ICAgICAgaGVpZ2h0OiBoZWlnaHQgKiBkZW5zaXR5LFxuXHQgICAgICB3aWR0aDogd2lkdGggKiBkZW5zaXR5LFxuXHQgICAgICBvbkRyYWdPdmVyOiB0aGlzLl9vblJlbGVhc2Vcblx0ICAgIH0sIHRvdWNoRXZlbnRzKSk7XG5cdCAgfSxcblx0XG5cdCAgX29uUHJlc3M6IGZ1bmN0aW9uIF9vblByZXNzKGUpIHtcblx0ICAgIHZhciBidXR0b24gPSBlLmJ1dHRvbjtcblx0ICAgIHZhciBjdHJsS2V5ID0gZS5jdHJsS2V5O1xuXHQgICAgdmFyIGNsaWVudFggPSBlLmNsaWVudFg7XG5cdCAgICB2YXIgY2xpZW50WSA9IGUuY2xpZW50WTtcblx0ICAgIHZhciBjaGFuZ2VkVG91Y2hlcyA9IGUuY2hhbmdlZFRvdWNoZXM7XG5cdFxuXHQgICAgdmFyIHRpbWVTdGFtcCA9IERhdGUubm93KCk7XG5cdFxuXHQgICAgaWYgKGNoYW5nZWRUb3VjaGVzKSB7XG5cdCAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbmdlZFRvdWNoZXMubGVuZ3RoOyBpKyspIHtcblx0ICAgICAgICB2YXIgX2NoYW5nZWRUb3VjaGVzJGkgPSBjaGFuZ2VkVG91Y2hlc1tpXTtcblx0ICAgICAgICB2YXIgX2NsaWVudFggPSBfY2hhbmdlZFRvdWNoZXMkaS5jbGllbnRYO1xuXHQgICAgICAgIHZhciBfY2xpZW50WSA9IF9jaGFuZ2VkVG91Y2hlcyRpLmNsaWVudFk7XG5cdFxuXHQgICAgICAgIHRoaXMucHVzaEJsb3QodGltZVN0YW1wLCBfY2xpZW50WCwgX2NsaWVudFkpO1xuXHQgICAgICB9XG5cdCAgICB9IGVsc2UgaWYgKGJ1dHRvbiA9PT0gTU9VU0VfTEVGVCAmJiAhY3RybEtleSkge1xuXHQgICAgICB0aGlzLnB1c2hCbG90KHRpbWVTdGFtcCwgY2xpZW50WCwgY2xpZW50WSk7XG5cdCAgICB9XG5cdCAgfSxcblx0XG5cdCAgX29uUmVsZWFzZTogZnVuY3Rpb24gX29uUmVsZWFzZSgpIHtcblx0ICAgIHRoaXMuc3RhdGUuc3RvcmUucmVsZWFzZShEYXRlLm5vdygpKTtcblx0ICB9XG5cdH0pO1xuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBJbms7XG5cbi8qKiovIH0sXG4vKiAxICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgZWFzaW5nID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTtcblx0dmFyIFNRUlRfMiA9IE1hdGguc3FydCgyKTtcblx0dmFyIGNvcyA9IE1hdGguY29zO1xuXHR2YXIgbWF4ID0gTWF0aC5tYXg7XG5cdHZhciBtaW4gPSBNYXRoLm1pbjtcblx0XG5cdGZ1bmN0aW9uIGdldFByZXNzKGJsb3QpIHtcblx0ICByZXR1cm4gbWluKGJsb3QuZHVyYXRpb24sIERhdGUubm93KCkgLSBibG90Lm1vdXNlRG93bik7XG5cdH1cblx0XG5cdGZ1bmN0aW9uIGdldFJlbGVhc2UoYmxvdCkge1xuXHQgIHJldHVybiBibG90Lm1vdXNlVXAgPiAwID8gRGF0ZS5ub3coKSAtIGJsb3QubW91c2VVcCA6IDA7XG5cdH1cblx0XG5cdGZ1bmN0aW9uIGdldFJhZGl1cyhibG90KSB7XG5cdCAgdmFyIGR1cmF0aW9uID0gYmxvdC5kdXJhdGlvbjtcblx0ICB2YXIgcmFkaXVzID0gYmxvdC5yYWRpdXM7XG5cdFxuXHQgIHZhciBkb3duID0gZWFzaW5nKGdldFByZXNzKGJsb3QpLCAwLCByYWRpdXMsIGR1cmF0aW9uKSAqIDAuODU7XG5cdCAgdmFyIHVwID0gZWFzaW5nKGdldFJlbGVhc2UoYmxvdCksIDAsIHJhZGl1cywgZHVyYXRpb24pICogMC4xNTtcblx0ICB2YXIgdW5kdWxhdGlvbiA9IHJhZGl1cyAqIDAuMDIgKiBjb3MoRGF0ZS5ub3coKSAvIGR1cmF0aW9uKTtcblx0XG5cdCAgcmV0dXJuIG1heCgwLCBkb3duICsgdXAgKyB1bmR1bGF0aW9uKTtcblx0fVxuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSB7XG5cdFxuXHQgIGdldE1heFJhZGl1czogZnVuY3Rpb24gZ2V0TWF4UmFkaXVzKGhlaWdodCwgd2lkdGgsIHJhZGl1cykge1xuXHQgICAgcmV0dXJuIG1pbihtYXgoaGVpZ2h0LCB3aWR0aCkgKiAwLjUsIHJhZGl1cyk7XG5cdCAgfSxcblx0XG5cdCAgZ2V0QmxvdE9wYWNpdHk6IGZ1bmN0aW9uIGdldEJsb3RPcGFjaXR5KGJsb3QsIG9wYWNpdHkpIHtcblx0ICAgIHJldHVybiBlYXNpbmcoZ2V0UmVsZWFzZShibG90KSwgb3BhY2l0eSwgLW9wYWNpdHksIGJsb3QuZHVyYXRpb24pO1xuXHQgIH0sXG5cdFxuXHQgIGdldEJsb3RPdXRlck9wYWNpdHk6IGZ1bmN0aW9uIGdldEJsb3RPdXRlck9wYWNpdHkoYmxvdCwgb3BhY2l0eSkge1xuXHQgICAgcmV0dXJuIG1pbih0aGlzLmdldEJsb3RPcGFjaXR5KGJsb3QsIG9wYWNpdHkpLCBlYXNpbmcoZ2V0UHJlc3MoYmxvdCksIDAsIDAuMywgYmxvdC5kdXJhdGlvbiAqIDMpKTtcblx0ICB9LFxuXHRcblx0ICBnZXRCbG90U2hpZnRYOiBmdW5jdGlvbiBnZXRCbG90U2hpZnRYKGJsb3QsIHNpemUsIHdpZHRoKSB7XG5cdCAgICByZXR1cm4gbWluKDEsIGdldFJhZGl1cyhibG90KSAvIHNpemUgKiAyIC8gU1FSVF8yKSAqICh3aWR0aCAvIDIgLSBibG90LngpO1xuXHQgIH0sXG5cdFxuXHQgIGdldEJsb3RTaGlmdFk6IGZ1bmN0aW9uIGdldEJsb3RTaGlmdFkoYmxvdCwgc2l6ZSwgaGVpZ2h0KSB7XG5cdCAgICByZXR1cm4gbWluKDEsIGdldFJhZGl1cyhibG90KSAvIHNpemUgKiAyIC8gU1FSVF8yKSAqIChoZWlnaHQgLyAyIC0gYmxvdC55KTtcblx0ICB9LFxuXHRcblx0ICBnZXRCbG90U2NhbGU6IGZ1bmN0aW9uIGdldEJsb3RTY2FsZShibG90KSB7XG5cdCAgICByZXR1cm4gZ2V0UmFkaXVzKGJsb3QpIC8gYmxvdC5yYWRpdXM7XG5cdCAgfVxuXHR9O1xuXG4vKioqLyB9LFxuLyogMiAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0XCJ1c2Ugc3RyaWN0XCI7XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IHtcblx0ICBib3JkZXJSYWRpdXM6IFwiaW5oZXJpdFwiLFxuXHQgIGhlaWdodDogXCIxMDAlXCIsXG5cdCAgbGVmdDogMCxcblx0ICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuXHQgIHRvcDogMCxcblx0ICB3aWR0aDogXCIxMDAlXCJcblx0fTtcblxuLyoqKi8gfSxcbi8qIDMgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdC8qKlxuXHQgKiBAdCBpcyB0aGUgY3VycmVudCB0aW1lIChvciBwb3NpdGlvbikgb2YgdGhlIHR3ZWVuLiBUaGlzIGNhbiBiZSBzZWNvbmRzIG9yIGZyYW1lcywgc3RlcHMsIHNlY29uZHMsIG1zLCB3aGF0ZXZlciDigJMgYXMgbG9uZyBhcyB0aGUgdW5pdCBpcyB0aGUgc2FtZSBhcyBpcyB1c2VkIGZvciB0aGUgdG90YWwgdGltZSBbM10uXG5cdCAqIEBiIGlzIHRoZSBiZWdpbm5pbmcgdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuXHQgKiBAYyBpcyB0aGUgY2hhbmdlIGJldHdlZW4gdGhlIGJlZ2lubmluZyBhbmQgZGVzdGluYXRpb24gdmFsdWUgb2YgdGhlIHByb3BlcnR5LlxuXHQgKiBAZCBpcyB0aGUgdG90YWwgdGltZSBvZiB0aGUgdHdlZW4uXG5cdCAqL1xuXHRcblx0XCJ1c2Ugc3RyaWN0XCI7XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGVhc2VPdXRRdWludCh0LCBiLCBjLCBkKSB7XG5cdCAgcmV0dXJuIGMgKiAoKHQgPSB0IC8gZCAtIDEpICogdCAqIHQgKiB0ICogdCArIDEpICsgYjtcblx0fTtcblxuLyoqKi8gfSxcbi8qIDQgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdCd1c2Ugc3RyaWN0Jztcblx0XG5cdHZhciBib29sID0gZmFsc2U7XG5cdFxuXHRpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0ICBib29sID0gJ29udG91Y2hzdGFydCcgaW4gd2luZG93IHx8IHdpbmRvdy5Eb2N1bWVudFRvdWNoICYmIGRvY3VtZW50IGluc3RhbmNlb2YgRG9jdW1lbnRUb3VjaDtcblx0fVxuXHRcblx0bW9kdWxlLmV4cG9ydHMgPSBib29sO1xuXG4vKioqLyB9LFxuLyogNSAqL1xuLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cblx0Ly8gR29vZCBzdHVmZiBoZXJlOlxuXHQvLyBodHRwOi8vd3d3Lmh0bWw1cm9ja3MuY29tL2VuL3R1dG9yaWFscy9jYW52YXMvaGlkcGkvXG5cdFxuXHRcInVzZSBzdHJpY3RcIjtcblx0XG5cdGV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cdFxuXHRleHBvcnRzW1wiZGVmYXVsdFwiXSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTtcblx0ICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJhY2tpbmdTdG9yZVJhdGlvID0gY29udGV4dC53ZWJraXRCYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IGNvbnRleHQubW96QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjb250ZXh0Lm1zQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjb250ZXh0Lm9CYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IGNvbnRleHQuYmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCAxO1xuXHRcblx0ICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRldmljZVBpeGVsUmF0aW8gLyBiYWNraW5nU3RvcmVSYXRpbztcblx0fTtcblx0XG5cdG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07XG5cbi8qKiovIH0sXG4vKiA2ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRcInVzZSBzdHJpY3RcIjtcblx0XG5cdGV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cdGV4cG9ydHNbXCJkZWZhdWx0XCJdID0gUHVyZTtcblx0XG5cdGZ1bmN0aW9uIFB1cmUocHJvcHMsIHN0YXRlKSB7XG5cdCAgZm9yICh2YXIgcCBpbiBwcm9wcykge1xuXHQgICAgaWYgKHRoaXMucHJvcHNbcF0gIT09IHByb3BzW3BdKSByZXR1cm4gdHJ1ZTtcblx0ICB9XG5cdFxuXHQgIGZvciAodmFyIHMgaW4gc3RhdGUpIHtcblx0ICAgIGlmICh0aGlzLnN0YXRlW3NdICE9PSBzdGF0ZVtzXSkgcmV0dXJuIHRydWU7XG5cdCAgfVxuXHRcblx0ICByZXR1cm4gZmFsc2U7XG5cdH1cblx0XG5cdG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07XG5cbi8qKiovIH0sXG4vKiA3ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXHQvKipcblx0ICogSW5rIFN0b3JlXG5cdCAqIEtlZXBzIHRyYWNrIG9mIGNoYW5nZXMgdG8gcmlwcGxlIGVwaWNlbnRlcnNcblx0ICogc28gdGhhdCA8SW5rIC8+IGNhbiBmb2N1cyBvbiByZW5kZXJpbmcgdGhlbS5cblx0ICovXG5cdFxuXHQndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgRXF1YXRpb25zID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblx0XG5cdHZhciBraWxsU3RhbGUgPSBmdW5jdGlvbiBraWxsU3RhbGUoX3JlZikge1xuXHQgIHZhciBtb3VzZVVwID0gX3JlZi5tb3VzZVVwO1xuXHQgIHZhciBkdXJhdGlvbiA9IF9yZWYuZHVyYXRpb247XG5cdCAgcmV0dXJuICFtb3VzZVVwIHx8IERhdGUubm93KCkgLSBtb3VzZVVwIDwgZHVyYXRpb247XG5cdH07XG5cdFxuXHRtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChwdWJsaWNpemUpIHtcblx0ICB2YXIgX2RhdGEgPSBbXTtcblx0ICB2YXIgX3BsYXlpbmcgPSBmYWxzZTtcblx0ICB2YXIgX2ZyYW1lID0gdW5kZWZpbmVkO1xuXHRcblx0ICB2YXIgU3RvcmUgPSB7XG5cdFxuXHQgICAgZWFjaDogZnVuY3Rpb24gZWFjaChjYWxsYmFjaywgc2NvcGUpIHtcblx0ICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBfZGF0YS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0ICAgICAgICBjYWxsYmFjay5jYWxsKHNjb3BlLCBfZGF0YVtpXSk7XG5cdCAgICAgIH1cblx0ICAgIH0sXG5cdFxuXHQgICAgcGxheTogZnVuY3Rpb24gcGxheSgpIHtcblx0ICAgICAgaWYgKCFfcGxheWluZykge1xuXHQgICAgICAgIF9wbGF5aW5nID0gdHJ1ZTtcblx0ICAgICAgICBTdG9yZS51cGRhdGUoKTtcblx0ICAgICAgfVxuXHQgICAgfSxcblx0XG5cdCAgICBzdG9wOiBmdW5jdGlvbiBzdG9wKCkge1xuXHQgICAgICBfcGxheWluZyA9IGZhbHNlO1xuXHQgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShfZnJhbWUpO1xuXHQgICAgfSxcblx0XG5cdCAgICBnZXRUb3RhbE9wYWNpdHk6IGZ1bmN0aW9uIGdldFRvdGFsT3BhY2l0eShvcGFjaXR5KSB7XG5cdCAgICAgIHZhciBhbnN3ZXIgPSAwO1xuXHRcblx0ICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBfZGF0YS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcblx0ICAgICAgICBhbnN3ZXIgKz0gRXF1YXRpb25zLmdldEJsb3RPdXRlck9wYWNpdHkoX2RhdGFbaV0sIG9wYWNpdHkpO1xuXHQgICAgICB9XG5cdFxuXHQgICAgICByZXR1cm4gYW5zd2VyO1xuXHQgICAgfSxcblx0XG5cdCAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZSgpIHtcblx0ICAgICAgX2RhdGEgPSBfZGF0YS5maWx0ZXIoa2lsbFN0YWxlKTtcblx0XG5cdCAgICAgIGlmIChfZGF0YS5sZW5ndGgpIHtcblx0ICAgICAgICBfZnJhbWUgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoU3RvcmUudXBkYXRlKTtcblx0ICAgICAgICBwdWJsaWNpemUoKTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICBTdG9yZS5zdG9wKCk7XG5cdCAgICAgIH1cblx0ICAgIH0sXG5cdFxuXHQgICAgYWRkOiBmdW5jdGlvbiBhZGQocHJvcHMpIHtcblx0ICAgICAgX2RhdGEucHVzaChwcm9wcyk7XG5cdCAgICAgIFN0b3JlLnBsYXkoKTtcblx0ICAgIH0sXG5cdFxuXHQgICAgcmVsZWFzZTogZnVuY3Rpb24gcmVsZWFzZSh0aW1lKSB7XG5cdCAgICAgIGZvciAodmFyIGkgPSBfZGF0YS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuXHQgICAgICAgIGlmICghX2RhdGFbaV0ubW91c2VVcCkge1xuXHQgICAgICAgICAgcmV0dXJuIF9kYXRhW2ldLm1vdXNlVXAgPSB0aW1lO1xuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHQgICAgfVxuXHRcblx0ICB9O1xuXHRcblx0ICByZXR1cm4gU3RvcmU7XG5cdH07XG5cbi8qKiovIH0sXG4vKiA4ICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcblxuLyoqKi8gfVxuLyoqKioqKi8gXSk7XG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogaW5rLmpzXG4gKiovIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG5cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGV4cG9ydHM6IHt9LFxuIFx0XHRcdGlkOiBtb2R1bGVJZCxcbiBcdFx0XHRsb2FkZWQ6IGZhbHNlXG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oMCk7XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiB3ZWJwYWNrL2Jvb3RzdHJhcCBjMjhmMWNkM2E2NzYwNTczMDg2OFxuICoqLyIsIi8qKlxuICogSW5rXG4gKiBGaWxscyBhIGNvbnRhaW5lciB3aXRoIGFuIFNWRyBvYmplY3QgdGhhdCBwcm92aWRlcyBmZWVkYmFjayBvbiBtb3VzZS90b3VjaFxuICogZXZlbnRzIHdpdGggYSByaXBwbGluZyBwb29sLlxuICovXG5cbmxldCBIQVNfVE9VQ0ggID0gcmVxdWlyZSgnLi91dGlsL2hhc1RvdWNoJylcbmxldCBNT1VTRV9MRUZUID0gMFxubGV0IHBpeGVsUmF0aW8gPSByZXF1aXJlKCcuL3V0aWwvcGl4ZWxSYXRpbycpXG5sZXQgUmVhY3QgICAgICA9IHJlcXVpcmUoJ3JlYWN0JylcbmxldCBTVFlMRSAgICAgID0gcmVxdWlyZSgnLi9zdHlsZScpXG5sZXQgU3RvcmUgICAgICA9IHJlcXVpcmUoJy4vdXRpbC9zdG9yZScpXG5sZXQgVHlwZXMgICAgICA9IFJlYWN0LlByb3BUeXBlc1xubGV0IFRBVSAgICAgICAgPSBNYXRoLlBJICogMlxubGV0IEVxdWF0aW9ucyAgPSByZXF1aXJlKCcuL3V0aWwvZXF1YXRpb25zJylcbmxldCBQdXJlICAgICAgID0gcmVxdWlyZSgnLi91dGlsL3B1cmUnKVxuXG5sZXQgSW5rID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXG4gIHNob3VsZENvbXBvbmVudFVwZGF0ZTogUHVyZSxcblxuICBwcm9wVHlwZXM6IHtcbiAgICBiYWNrZ3JvdW5kIDogVHlwZXMuYm9vbCxcbiAgICBkdXJhdGlvbiAgIDogVHlwZXMubnVtYmVyLFxuICAgIG9wYWNpdHkgICAgOiBUeXBlcy5udW1iZXIsXG4gICAgcmFkaXVzICAgICA6IFR5cGVzLm51bWJlcixcbiAgICByZWNlbnRlciAgIDogVHlwZXMuYm9vbCxcbiAgICBoYXNUb3VjaCAgIDogVHlwZXMuYm9vbFxuICB9LFxuXG4gIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYmFja2dyb3VuZCA6IHRydWUsXG4gICAgICBkdXJhdGlvbiAgIDogMTAwMCxcbiAgICAgIG9wYWNpdHkgICAgOiAwLjI1LFxuICAgICAgcmFkaXVzICAgICA6IDE1MCxcbiAgICAgIHJlY2VudGVyICAgOiB0cnVlLFxuICAgICAgaGFzVG91Y2ggICA6IEhBU19UT1VDSFxuICAgIH1cbiAgfSxcblxuICBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbG9yICAgICAgIDogJ3RyYW5zcGFyZW50JyxcbiAgICAgIGRlbnNpdHkgICAgIDogMSxcbiAgICAgIGhlaWdodCAgICAgIDogMCxcbiAgICAgIHN0b3JlICAgICAgIDogU3RvcmUodGhpcy50aWNrKSxcbiAgICAgIHRvdWNoRXZlbnRzIDogdGhpcy50b3VjaEV2ZW50cygpLFxuICAgICAgd2lkdGggICAgICAgOiAwXG4gICAgfVxuICB9LFxuXG4gIHRvdWNoRXZlbnRzKCkge1xuICAgIGlmICh0aGlzLnByb3BzLmhhc1RvdWNoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvblRvdWNoU3RhcnQgIDogdGhpcy5fb25QcmVzcyxcbiAgICAgICAgb25Ub3VjaEVuZCAgICA6IHRoaXMuX29uUmVsZWFzZSxcbiAgICAgICAgb25Ub3VjaENhbmNlbCA6IHRoaXMuX29uUmVsZWFzZSxcbiAgICAgICAgb25Ub3VjaExlYXZlICA6IHRoaXMuX29uUmVsZWFzZVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvbk1vdXNlRG93biAgIDogdGhpcy5fb25QcmVzcyxcbiAgICAgICAgb25Nb3VzZVVwICAgICA6IHRoaXMuX29uUmVsZWFzZSxcbiAgICAgICAgb25Nb3VzZUxlYXZlICA6IHRoaXMuX29uUmVsZWFzZVxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICB0aWNrKCkge1xuICAgIGxldCB7IGN0eCwgY29sb3IsIGRlbnNpdHksIGhlaWdodCwgd2lkdGgsIHN0b3JlIH0gPSB0aGlzLnN0YXRlXG5cbiAgICBjdHguc2F2ZSgpXG5cbiAgICBjdHguc2NhbGUoZGVuc2l0eSwgZGVuc2l0eSlcblxuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodClcblxuICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvclxuXG4gICAgaWYgKHRoaXMucHJvcHMuYmFja2dyb3VuZCkge1xuICAgICAgY3R4Lmdsb2JhbEFscGhhID0gc3RvcmUuZ2V0VG90YWxPcGFjaXR5KHRoaXMucHJvcHMub3BhY2l0eSlcbiAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KVxuICAgIH1cblxuICAgIHN0b3JlLmVhY2godGhpcy5tYWtlQmxvdCwgdGhpcylcblxuICAgIGN0eC5yZXN0b3JlKClcbiAgfSxcblxuICBtYWtlQmxvdChibG90KSB7XG4gICAgbGV0IHsgY3R4LCBoZWlnaHQsIHdpZHRoIH0gPSB0aGlzLnN0YXRlXG4gICAgbGV0IHsgeCwgeSwgcmFkaXVzIH0gPSBibG90XG5cbiAgICBjdHguZ2xvYmFsQWxwaGEgPSBFcXVhdGlvbnMuZ2V0QmxvdE9wYWNpdHkoYmxvdCwgdGhpcy5wcm9wcy5vcGFjaXR5KVxuICAgIGN0eC5iZWdpblBhdGgoKVxuXG4gICAgaWYgKHRoaXMucHJvcHMucmVjZW50ZXIpIHtcbiAgICAgIGxldCBzaXplID0gTWF0aC5tYXgoaGVpZ2h0LCB3aWR0aClcblxuICAgICAgeCArPSBFcXVhdGlvbnMuZ2V0QmxvdFNoaWZ0WChibG90LCBzaXplLCB3aWR0aClcbiAgICAgIHkgKz0gRXF1YXRpb25zLmdldEJsb3RTaGlmdFkoYmxvdCwgc2l6ZSwgaGVpZ2h0KVxuICAgIH1cblxuICAgIGN0eC5hcmMoeCwgeSwgcmFkaXVzICogRXF1YXRpb25zLmdldEJsb3RTY2FsZShibG90KSwgMCwgVEFVKVxuXG4gICAgY3R4LmNsb3NlUGF0aCgpXG4gICAgY3R4LmZpbGwoKVxuICB9LFxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMuc3RhdGUuc3RvcmUuc3RvcCgpXG4gIH0sXG5cbiAgcHVzaEJsb3QodGltZVN0YW1wLCBjbGllbnRYLCBjbGllbnRZKSB7XG4gICAgbGV0IGVsID0gdGhpcy5yZWZzLmNhbnZhc1xuXG4gICAgLy8gMC4xMyBzdXBwb3J0XG4gICAgaWYgKGVsIGluc3RhbmNlb2Ygd2luZG93LkhUTUxDYW52YXNFbGVtZW50ID09PSBmYWxzZSkge1xuICAgICAgZWwgPSBlbC5nZXRET01Ob2RlKClcbiAgICB9XG5cbiAgICBsZXQgeyB0b3AsIGJvdHRvbSwgbGVmdCwgcmlnaHQgfSA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgbGV0IHsgY29sb3IgfSAgICAgICAgICAgICAgICAgICAgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbClcblxuICAgIGxldCBjdHggICAgID0gdGhpcy5zdGF0ZS5jdHggfHwgZWwuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBsZXQgZGVuc2l0eSA9IHBpeGVsUmF0aW8oY3R4KVxuICAgIGxldCBoZWlnaHQgID0gYm90dG9tIC0gdG9wXG4gICAgbGV0IHdpZHRoICAgPSByaWdodCAtIGxlZnRcbiAgICBsZXQgcmFkaXVzICA9IEVxdWF0aW9ucy5nZXRNYXhSYWRpdXMoaGVpZ2h0LCB3aWR0aCwgdGhpcy5wcm9wcy5yYWRpdXMpXG5cbiAgICB0aGlzLnNldFN0YXRlKHsgY29sb3IsIGN0eCwgZGVuc2l0eSwgaGVpZ2h0LCB3aWR0aCB9LCAoKSA9PiB7XG4gICAgICB0aGlzLnN0YXRlLnN0b3JlLmFkZCh7XG4gICAgICAgIGR1cmF0aW9uICA6IHRoaXMucHJvcHMuZHVyYXRpb24sXG4gICAgICAgIG1vdXNlRG93biA6IHRpbWVTdGFtcCxcbiAgICAgICAgbW91c2VVcCAgIDogMCxcbiAgICAgICAgcmFkaXVzICAgIDogcmFkaXVzLFxuICAgICAgICB4ICAgICAgICAgOiBjbGllbnRYIC0gbGVmdCxcbiAgICAgICAgeSAgICAgICAgIDogY2xpZW50WSAtIHRvcFxuICAgICAgfSlcbiAgICB9KVxuICB9LFxuXG4gIHJlbmRlcigpIHtcbiAgICBsZXQgeyBkZW5zaXR5LCBoZWlnaHQsIHdpZHRoLCB0b3VjaEV2ZW50cyB9ID0gdGhpcy5zdGF0ZVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxjYW52YXMgY2xhc3NOYW1lPVwiaW5rXCJcbiAgICAgICAgICAgICAgcmVmPVwiY2FudmFzXCJcbiAgICAgICAgICAgICAgc3R5bGU9e3sgLi4uU1RZTEUsIC4uLnRoaXMucHJvcHMuc3R5bGUgfX1cbiAgICAgICAgICAgICAgaGVpZ2h0PXsgaGVpZ2h0ICogZGVuc2l0eSB9XG4gICAgICAgICAgICAgIHdpZHRoPXsgd2lkdGggKiBkZW5zaXR5IH1cbiAgICAgICAgICAgICAgb25EcmFnT3Zlcj17IHRoaXMuX29uUmVsZWFzZSB9XG4gICAgICAgICAgICAgIHsgLi4udG91Y2hFdmVudHMgfSAvPlxuICAgIClcbiAgfSxcblxuICBfb25QcmVzcyhlKSB7XG4gICAgbGV0IHsgYnV0dG9uLCBjdHJsS2V5LCBjbGllbnRYLCBjbGllbnRZLCBjaGFuZ2VkVG91Y2hlcyB9ID0gZVxuICAgIGxldCB0aW1lU3RhbXAgPSBEYXRlLm5vdygpXG5cbiAgICBpZiAoY2hhbmdlZFRvdWNoZXMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbmdlZFRvdWNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IHsgY2xpZW50WCwgY2xpZW50WSB9ID0gY2hhbmdlZFRvdWNoZXNbaV1cbiAgICAgICAgdGhpcy5wdXNoQmxvdCh0aW1lU3RhbXAsIGNsaWVudFgsIGNsaWVudFkpXG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChidXR0b24gPT09IE1PVVNFX0xFRlQgJiYgIWN0cmxLZXkpIHtcbiAgICAgIHRoaXMucHVzaEJsb3QodGltZVN0YW1wLCBjbGllbnRYLCBjbGllbnRZKVxuICAgIH1cbiAgfSxcblxuICBfb25SZWxlYXNlKCkge1xuICAgIHRoaXMuc3RhdGUuc3RvcmUucmVsZWFzZShEYXRlLm5vdygpKVxuICB9XG59KVxuXG5tb2R1bGUuZXhwb3J0cyA9IElua1xuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9zcmMvaW5kZXguanN4XG4gKiovIiwibGV0IGVhc2luZyA9IHJlcXVpcmUoJy4vZWFzaW5nJylcbmxldCBTUVJUXzIgPSBNYXRoLnNxcnQoMilcbmxldCB7IGNvcywgbWF4LCBtaW4gfSA9IE1hdGhcblxuZnVuY3Rpb24gZ2V0UHJlc3MoYmxvdCkge1xuICByZXR1cm4gbWluKGJsb3QuZHVyYXRpb24sIERhdGUubm93KCkgLSBibG90Lm1vdXNlRG93bilcbn1cblxuZnVuY3Rpb24gZ2V0UmVsZWFzZShibG90KSB7XG4gIHJldHVybiBibG90Lm1vdXNlVXAgPiAwID8gRGF0ZS5ub3coKSAtIGJsb3QubW91c2VVcCA6IDBcbn1cblxuZnVuY3Rpb24gZ2V0UmFkaXVzKGJsb3QpIHtcbiAgbGV0IHsgZHVyYXRpb24sIHJhZGl1cyB9ID0gYmxvdFxuXG4gIGxldCBkb3duICAgICAgID0gZWFzaW5nKGdldFByZXNzKGJsb3QpLCAwLCByYWRpdXMsIGR1cmF0aW9uKSAqIDAuODVcbiAgbGV0IHVwICAgICAgICAgPSBlYXNpbmcoZ2V0UmVsZWFzZShibG90KSwgMCwgcmFkaXVzLCBkdXJhdGlvbikgKiAwLjE1XG4gIGxldCB1bmR1bGF0aW9uID0gcmFkaXVzICogMC4wMiAqIGNvcyhEYXRlLm5vdygpIC8gZHVyYXRpb24pXG5cbiAgcmV0dXJuIG1heCgwLCBkb3duICsgdXAgKyB1bmR1bGF0aW9uKVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICBnZXRNYXhSYWRpdXMoaGVpZ2h0LCB3aWR0aCwgcmFkaXVzKSB7XG4gICAgcmV0dXJuIG1pbihtYXgoaGVpZ2h0LCB3aWR0aCkgKiAwLjUsIHJhZGl1cylcbiAgfSxcblxuICBnZXRCbG90T3BhY2l0eShibG90LCBvcGFjaXR5KSB7XG4gICAgcmV0dXJuIGVhc2luZyhnZXRSZWxlYXNlKGJsb3QpLCBvcGFjaXR5LCAtb3BhY2l0eSwgYmxvdC5kdXJhdGlvbilcbiAgfSxcblxuICBnZXRCbG90T3V0ZXJPcGFjaXR5KGJsb3QsIG9wYWNpdHkpIHtcbiAgICByZXR1cm4gbWluKHRoaXMuZ2V0QmxvdE9wYWNpdHkoYmxvdCwgb3BhY2l0eSksXG4gICAgICAgICAgICAgICBlYXNpbmcoZ2V0UHJlc3MoYmxvdCksIDAsIDAuMywgYmxvdC5kdXJhdGlvbiAqIDMpKVxuICB9LFxuXG4gIGdldEJsb3RTaGlmdFgoYmxvdCwgc2l6ZSwgd2lkdGgpIHtcbiAgICByZXR1cm4gbWluKDEsXG4gICAgICAgICAgICAgICBnZXRSYWRpdXMoYmxvdCkgLyBzaXplICogMiAvIFNRUlRfMikgKiAod2lkdGggLyAyIC0gYmxvdC54KVxuICB9LFxuXG4gIGdldEJsb3RTaGlmdFkoYmxvdCwgc2l6ZSwgaGVpZ2h0KSB7XG4gICAgcmV0dXJuIG1pbigxLFxuICAgICAgICAgICAgICAgZ2V0UmFkaXVzKGJsb3QpIC8gc2l6ZSAqIDIgLyBTUVJUXzIpICogKGhlaWdodCAvIDIgLSBibG90LnkpXG4gIH0sXG5cbiAgZ2V0QmxvdFNjYWxlKGJsb3QpIHtcbiAgICByZXR1cm4gZ2V0UmFkaXVzKGJsb3QpIC8gYmxvdC5yYWRpdXNcbiAgfVxufVxuXG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogLi9zcmMvdXRpbC9lcXVhdGlvbnMuanNcbiAqKi8iLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgYm9yZGVyUmFkaXVzOiBcImluaGVyaXRcIixcbiAgaGVpZ2h0OiBcIjEwMCVcIixcbiAgbGVmdDogMCxcbiAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgdG9wOiAwLFxuICB3aWR0aDogXCIxMDAlXCJcbn1cblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vc3JjL3N0eWxlLmpzXG4gKiovIiwiLyoqXG4gKiBAdCBpcyB0aGUgY3VycmVudCB0aW1lIChvciBwb3NpdGlvbikgb2YgdGhlIHR3ZWVuLiBUaGlzIGNhbiBiZSBzZWNvbmRzIG9yIGZyYW1lcywgc3RlcHMsIHNlY29uZHMsIG1zLCB3aGF0ZXZlciDigJMgYXMgbG9uZyBhcyB0aGUgdW5pdCBpcyB0aGUgc2FtZSBhcyBpcyB1c2VkIGZvciB0aGUgdG90YWwgdGltZSBbM10uXG4gKiBAYiBpcyB0aGUgYmVnaW5uaW5nIHZhbHVlIG9mIHRoZSBwcm9wZXJ0eS5cbiAqIEBjIGlzIHRoZSBjaGFuZ2UgYmV0d2VlbiB0aGUgYmVnaW5uaW5nIGFuZCBkZXN0aW5hdGlvbiB2YWx1ZSBvZiB0aGUgcHJvcGVydHkuXG4gKiBAZCBpcyB0aGUgdG90YWwgdGltZSBvZiB0aGUgdHdlZW4uXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBlYXNlT3V0UXVpbnQgKHQsIGIsIGMsIGQpIHtcbiAgcmV0dXJuIGMqKCh0PXQvZC0xKSp0KnQqdCp0ICsgMSkgKyBiXG59XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL3NyYy91dGlsL2Vhc2luZy5qc1xuICoqLyIsInZhciBib29sID0gZmFsc2VcblxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gIGJvb2wgPSAoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KSB8fCB3aW5kb3cuRG9jdW1lbnRUb3VjaCAmJiBkb2N1bWVudCBpbnN0YW5jZW9mIERvY3VtZW50VG91Y2hcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBib29sXG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL3NyYy91dGlsL2hhc1RvdWNoLmpzXG4gKiovIiwiLy8gR29vZCBzdHVmZiBoZXJlOlxuLy8gaHR0cDovL3d3dy5odG1sNXJvY2tzLmNvbS9lbi90dXRvcmlhbHMvY2FudmFzL2hpZHBpL1xuXG5leHBvcnQgZGVmYXVsdCBjb250ZXh0ID0+IHtcbiAgbGV0IGRldmljZVBpeGVsUmF0aW8gID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMVxuICBsZXQgYmFja2luZ1N0b3JlUmF0aW8gPSBjb250ZXh0LndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5tb3pCYWNraW5nU3RvcmVQaXhlbFJhdGlvICAgIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQubXNCYWNraW5nU3RvcmVQaXhlbFJhdGlvICAgICB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0Lm9CYWNraW5nU3RvcmVQaXhlbFJhdGlvICAgICAgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5iYWNraW5nU3RvcmVQaXhlbFJhdGlvICAgICAgIHx8IDFcblxuICByZXR1cm4gZGV2aWNlUGl4ZWxSYXRpbyAvIGJhY2tpbmdTdG9yZVJhdGlvXG59XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL3NyYy91dGlsL3BpeGVsUmF0aW8uanNcbiAqKi8iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBQdXJlIChwcm9wcywgc3RhdGUpIHtcbiAgZm9yIChsZXQgcCBpbiBwcm9wcykge1xuICAgIGlmICh0aGlzLnByb3BzW3BdICE9PSBwcm9wc1twXSkgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGZvciAobGV0IHMgaW4gc3RhdGUpIHtcbiAgICBpZiAodGhpcy5zdGF0ZVtzXSAhPT0gc3RhdGVbc10pIHJldHVybiB0cnVlXG4gIH1cblxuICByZXR1cm4gZmFsc2Vcbn1cblxuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC4vc3JjL3V0aWwvcHVyZS5qc1xuICoqLyIsIi8qKlxuICogSW5rIFN0b3JlXG4gKiBLZWVwcyB0cmFjayBvZiBjaGFuZ2VzIHRvIHJpcHBsZSBlcGljZW50ZXJzXG4gKiBzbyB0aGF0IDxJbmsgLz4gY2FuIGZvY3VzIG9uIHJlbmRlcmluZyB0aGVtLlxuICovXG5cbnZhciBFcXVhdGlvbnMgPSByZXF1aXJlKCcuL2VxdWF0aW9ucycpXG5cbmxldCBraWxsU3RhbGUgPSAoeyBtb3VzZVVwLCBkdXJhdGlvbiB9KSA9PiAhbW91c2VVcCB8fCAoRGF0ZS5ub3coKSAtIG1vdXNlVXApIDwgZHVyYXRpb25cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihwdWJsaWNpemUpIHtcbiAgbGV0IF9kYXRhICAgID0gW11cbiAgbGV0IF9wbGF5aW5nID0gZmFsc2VcbiAgbGV0IF9mcmFtZVxuXG4gIGxldCBTdG9yZSA9IHtcblxuICAgIGVhY2goY2FsbGJhY2ssIHNjb3BlKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IF9kYXRhLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICBjYWxsYmFjay5jYWxsKHNjb3BlLCBfZGF0YVtpXSlcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcGxheSgpIHtcbiAgICAgIGlmICghX3BsYXlpbmcpIHtcbiAgICAgICAgX3BsYXlpbmcgPSB0cnVlXG4gICAgICAgIFN0b3JlLnVwZGF0ZSgpXG4gICAgICB9XG4gICAgfSxcblxuICAgIHN0b3AoKSB7XG4gICAgICBfcGxheWluZyA9IGZhbHNlO1xuICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoX2ZyYW1lKVxuICAgIH0sXG5cbiAgICBnZXRUb3RhbE9wYWNpdHkob3BhY2l0eSkge1xuICAgICAgbGV0IGFuc3dlciA9IDBcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBfZGF0YS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgYW5zd2VyICs9IEVxdWF0aW9ucy5nZXRCbG90T3V0ZXJPcGFjaXR5KF9kYXRhW2ldLCBvcGFjaXR5KVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gYW5zd2VyXG4gICAgfSxcblxuICAgIHVwZGF0ZSgpIHtcbiAgICAgIF9kYXRhID0gX2RhdGEuZmlsdGVyKGtpbGxTdGFsZSlcblxuICAgICAgaWYgKF9kYXRhLmxlbmd0aCkge1xuICAgICAgICBfZnJhbWUgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoU3RvcmUudXBkYXRlKVxuICAgICAgICBwdWJsaWNpemUoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgU3RvcmUuc3RvcCgpXG4gICAgICB9XG4gICAgfSxcblxuICAgIGFkZChwcm9wcykge1xuICAgICAgX2RhdGEucHVzaChwcm9wcylcbiAgICAgIFN0b3JlLnBsYXkoKVxuICAgIH0sXG5cbiAgICByZWxlYXNlKHRpbWUpIHtcbiAgICAgIGZvciAobGV0IGkgPSBfZGF0YS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICBpZiAoIV9kYXRhW2ldLm1vdXNlVXApIHtcbiAgICAgICAgICByZXR1cm4gX2RhdGFbaV0ubW91c2VVcCA9IHRpbWVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgcmV0dXJuIFN0b3JlXG59XG5cblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAuL3NyYy91dGlsL3N0b3JlLmpzXG4gKiovIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwicmVhY3RcIik7XG5cblxuLyoqKioqKioqKioqKioqKioqXG4gKiogV0VCUEFDSyBGT09URVJcbiAqKiBleHRlcm5hbCBcInJlYWN0XCJcbiAqKiBtb2R1bGUgaWQgPSA4XG4gKiogbW9kdWxlIGNodW5rcyA9IDBcbiAqKi8iXSwic291cmNlUm9vdCI6IiJ9